reverse lists built from formatting string so that result string is built from left to right, because of %n, requires a modification of lstadd function and different state structure.
decide which lists to convert to arrays
